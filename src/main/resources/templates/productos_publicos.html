<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlazaChina - Productos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Usa solo Bootstrap Icons, elimina FontAwesome si ya no lo usas -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(to right, #6a11cb 0%, #2575fc 100%);
        }
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen">

    <nav class="bg-white shadow-md p-4 flex justify-between items-center">
        <div class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-orange-500 to-red-500 flex items-center gap-2">
            <i class="bi bi-shop"></i>
            <a href="/" class="text-inherit">PlazaChina</a>
        </div>
        <div class="flex items-center space-x-4">
            <a href="/" class="text-gray-700 hover:text-orange-600 font-medium flex items-center gap-1">
                <i class="bi bi-house-door"></i> Inicio
            </a>
            <a href="/login" class="text-gray-700 hover:text-orange-600 font-medium flex items-center gap-1">
                <i class="bi bi-box-arrow-in-right"></i> Iniciar Sesión
            </a>
            <a href="/registro" class="text-gray-700 hover:text-orange-600 font-medium flex items-center gap-1">
                <i class="bi bi-person-plus"></i> Registrarse
            </a>
        </div>
    </nav>

    <main class="flex-grow container mx-auto p-4 md:p-8">
        <h2 class="text-4xl font-extrabold text-gray-800 text-center mb-10">Explora Nuestros Productos</h2>

        <div class="bg-white p-6 rounded-2xl shadow-lg mb-8">
            <h3 class="text-2xl font-semibold text-gray-700 mb-4">Filtros y Búsqueda</h3>
            <form th:action="@{/productos-publicos}" method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                <div>
                    <label for="categoria" class="block text-sm font-medium text-gray-700 mb-1">Categoría:</label>
                    <select id="categoria" name="categoria" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="">Todas</option>
                        <option th:each="cat : ${categorias}" th:value="${cat}" th:text="${cat}" th:selected="${cat == selectedCategoria}"></option>
                    </select>
                </div>
                <div>
                    <label for="genero" class="block text-sm font-medium text-gray-700 mb-1">Género:</label>
                    <select id="genero" name="genero" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="">Todos</option>
                        <option th:each="gen : ${generos}" th:value="${gen}" th:text="${gen}" th:selected="${gen == selectedGenero}"></option>
                    </select>
                </div>
                <div>
                    <label for="talla" class="block text-sm font-medium text-gray-700 mb-1">Talla:</label>
                    <select id="talla" name="talla" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="">Todas</option>
                        <option th:each="tal : ${tallas}" th:value="${tal}" th:text="${tal}" th:selected="${tal == selectedTalla}"></option>
                    </select>
                </div>
                <div class="md:col-span-1">
                    <label for="search" class="block text-sm font-medium text-gray-700 mb-1">Buscar:</label>
                    <input type="text" id="search" name="search" th:value="${searchTerm}" placeholder="Buscar por nombre o descripción..." class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-2">
                </div>
                <div class="md:col-span-4 flex justify-end">
                    <button type="submit" class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-6 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 flex items-center gap-2">
                        <i class="bi bi-funnel"></i> Aplicar Filtros
                    </button>
                    <a th:href="@{/productos-publicos}" class="ml-4 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 flex items-center gap-2">
                        <i class="bi bi-x-circle"></i> Limpiar Filtros
                    </a>
                </div>
            </form>
        </div>

        <div th:if="${#lists.isEmpty(productos)}" class="text-center text-gray-600 text-xl py-10">
            No se encontraron productos con los criterios de búsqueda.
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <div th:each="producto : ${productos}" class="bg-white rounded-2xl overflow-hidden card-shadow hover:shadow-xl transition-shadow duration-300 ease-in-out">
                <img th:src="${producto.imagenUrl != null and producto.imagenUrl != '' ? producto.imagenUrl : 'https://placehold.co/400x300/E0E0E0/6A11CB?text=Producto'}"
                     alt="Imagen del producto" class="w-full h-48 object-cover object-center">
                <div class="p-5">
                    <h3 class="text-xl font-semibold text-gray-800 mb-2" th:text="${producto.nombre}">Nombre del Producto</h3>
                    <p class="text-gray-600 text-sm mb-3" th:text="${producto.categoria} + ' - ' + ${producto.genero} + ' - Talla: ' + ${producto.talla}">Categoría - Género - Talla</p>

                    <div class="flex items-baseline mb-3">
                        <span th:if="${producto.descuento > 0}" class="text-red-500 font-bold text-lg mr-2"
                              th:text="'S/ ' + ${#numbers.formatDecimal(producto.precio * (1 - producto.descuento/100), 1, 'COMMA', 2, 'POINT')}">S/ XX.XX</span>
                        <span th:classappend="${producto.descuento > 0 ? 'line-through text-gray-500 text-sm' : 'text-blue-700 font-bold text-xl'}"
                              th:text="'S/ ' + ${#numbers.formatDecimal(producto.precio, 1, 'COMMA', 2, 'POINT')}">S/ XX.XX</span>
                        <span th:if="${producto.descuento > 0}" class="ml-2 bg-red-100 text-red-800 text-xs font-semibold px-2.5 py-0.5 rounded-full"
                              th:text="${#numbers.formatDecimal(producto.descuento, 0, 0) + '% OFF'}">XX% OFF</span>
                    </div>

                    <p th:classappend="${producto.stock > 0 ? 'text-green-600' : 'text-red-600'}" class="text-sm font-medium mb-4">
                        Stock: <span th:text="${producto.stock}"></span>
                        <span th:if="${producto.stock == 0}" class="ml-1">(Agotado)</span>
                    </p>

                    <div class="flex flex-col space-y-3">
                        <button class="bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-xl cursor-not-allowed opacity-70" disabled>
                            Agregar al Carrito
                        </button>
                        <button onclick="showProductDetailsModal(this)"
                                th:data-id="${producto.id}"
                                th:data-nombre="${producto.nombre}"
                                th:data-descripcion="${producto.descripcion}"
                                th:data-categoria="${producto.categoria}"
                                th:data-genero="${producto.genero}"
                                th:data-talla="${producto.talla}"
                                th:data-precio="${producto.precio}"
                                th:data-descuento="${producto.descuento}"
                                th:data-stock="${producto.stock}"
                                th:data-imagenurl="${producto.imagenUrl}"
                                th:data-tela="${producto.tela}"
                                class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded-xl transition duration-300 ease-in-out transform hover:scale-105">
                            Ver más detalles
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="productDetailsModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-2xl shadow-xl max-w-2xl w-full mx-4 relative">
            <button onclick="hideProductDetailsModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            <div class="flex flex-col md:flex-row gap-6">
                <div class="md:w-1/2">
                    <img id="modal-imagen" src="https://placehold.co/400x300/E0E0E0/6A11CB?text=Producto" alt="Imagen del producto" class="w-full h-auto rounded-lg object-cover">
                </div>
                <div class="md:w-1/2">
                    <h3 id="modal-nombre" class="text-3xl font-bold text-gray-800 mb-3">Nombre del Producto</h3>
                    <p class="text-gray-600 mb-2"><strong>Categoría:</strong> <span id="modal-categoria"></span></p>
                    <p class="text-gray-600 mb-2"><strong>Género:</strong> <span id="modal-genero"></span></p>
                    <p class="text-gray-600 mb-2"><strong>Talla:</strong> <span id="modal-talla"></span></p>
                    <p class="text-gray-600 mb-2"><strong>Tela:</strong> <span id="modal-tela"></span></p>
                    <p id="modal-descripcion" class="text-gray-700 text-base mb-4">Descripción detallada del producto.</p>

                    <div class="flex items-baseline mb-4">
                        <span id="modal-precio-descuento" class="text-red-500 font-bold text-2xl mr-2 hidden"></span>
                        <span id="modal-precio-original" class="text-blue-700 font-bold text-2xl"></span>
                        <span id="modal-descuento-badge" class="ml-2 bg-red-100 text-red-800 text-sm font-semibold px-2.5 py-0.5 rounded-full hidden"></span>
                    </div>

                    <p id="modal-stock" class="text-sm font-medium"></p>
                </div>
            </div>
        </div>
    </div>

   <!-- Footer completo -->
    <footer class="bg-gray-800 text-white pt-10 pb-6">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <!-- Información de contacto -->
                <div>
                    <h3 class="text-xl font-bold mb-4 text-red-400">Plaza China Ica</h3>
                    <p class="mb-2"><i class="bi bi-geo-alt-fill mr-2"></i> Av. Municipalidad #233, Ica</p>
                    <p class="mb-2"><i class="bi bi-telephone-fill mr-2"></i> (056) 123456</p>
                    <p class="mb-2"><i class="bi bi-whatsapp mr-2"></i> +51 987 654 321</p>
                    <p><i class="bi bi-envelope-fill mr-2"></i> contacto@plazachinaica.com</p>
                </div>
                <!-- Horario de atención -->
                <div>
                    <h3 class="text-xl font-bold mb-4 text-red-400">Horario</h3>
                    <p class="mb-2"><strong>Lunes a Viernes:</strong> 9:00 AM - 8:00 PM</p>
                    <p class="mb-2"><strong>Sábados:</strong> 9:00 AM - 9:00 PM</p>
                    <p><strong>Domingos:</strong> 9:00 AM - 6:00 PM</p>
                </div>
                <!-- Enlaces rápidos -->
                <div>
                    <h3 class="text-xl font-bold mb-4 text-red-400">Enlaces</h3>
                    <ul class="space-y-2">
                        <li><a href="/nosotros" class="hover:text-red-400 transition"><i class="bi bi-people"></i> Nosotros</a></li>
                        <li><a href="/productos" class="hover:text-red-400 transition"><i class="bi bi-box"></i> Productos</a></li>
                        <li><a href="/contacto" class="hover:text-red-400 transition"><i class="bi bi-envelope"></i> Contacto</a></li>
                        <li><a href="/terminos" class="hover:text-red-400 transition"><i class="bi bi-file-earmark-text"></i> Términos y condiciones</a></li>
                    </ul>
                </div>
                <!-- Redes sociales -->
                <div>
                    <h3 class="text-xl font-bold mb-4 text-red-400">Síguenos</h3>
                    <div class="flex space-x-4">
                        <a title="." href="#" class="text-2xl hover:text-red-400 transition"><i class="bi bi-facebook"></i></a>
                        <a title="." href="#" class="text-2xl hover:text-red-400 transition"><i class="bi bi-instagram"></i></a>
                        <a title="." href="#" class="text-2xl hover:text-red-400 transition"><i class="bi bi-tiktok"></i></a>
                        <a title="." href="#" class="text-2xl hover:text-red-400 transition"><i class="bi bi-youtube"></i></a>
                    </div>
                    <div class="mt-6">
                        <h4 class="font-semibold mb-2">Métodos de pago</h4>
                        <div class="flex flex-wrap gap-2">
                            <i class="bi bi-credit-card text-2xl"></i>
                            <i class="bi bi-paypal text-2xl"></i>
                            <i class="bi bi-cash-coin text-2xl"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-sm text-gray-400">
                <p>&copy; 2025 Plaza China Ica. Todos los derechos reservados.</p>
                <p class="mt-1">Desarrollado con <i class="bi bi-heart-fill text-red-400"></i> para los clientes de Ica</p>
            </div>
        </div>
    </footer>

    <script>
        // Función para mostrar el modal de detalles del producto
        function showProductDetailsModal(button) {
            const modal = document.getElementById('productDetailsModal');
            document.getElementById('modal-nombre').innerText = button.dataset.nombre;
            document.getElementById('modal-descripcion').innerText = button.dataset.descripcion;
            document.getElementById('modal-categoria').innerText = button.dataset.categoria;
            document.getElementById('modal-genero').innerText = button.dataset.genero;
            document.getElementById('modal-talla').innerText = button.dataset.talla;
            document.getElementById('modal-tela').innerText = button.dataset.tela;

            const precio = parseFloat(button.dataset.precio);
            const descuento = parseFloat(button.dataset.descuento);
            const precioOriginalSpan = document.getElementById('modal-precio-original');
            const precioDescuentoSpan = document.getElementById('modal-precio-descuento');
            const descuentoBadge = document.getElementById('modal-descuento-badge');

            if (descuento > 0) {
                const precioConDescuento = precio * (1 - descuento / 100);
                precioDescuentoSpan.innerText = `S/ ${precioConDescuento.toFixed(2)}`;
                precioDescuentoSpan.classList.remove('hidden');
                precioOriginalSpan.classList.add('line-through', 'text-gray-500', 'text-lg');
                precioOriginalSpan.classList.remove('text-blue-700', 'text-xl');
                precioOriginalSpan.innerText = `S/ ${precio.toFixed(2)}`;
                descuentoBadge.innerText = `${descuento.toFixed(0)}% OFF`;
                descuentoBadge.classList.remove('hidden');
            } else {
                precioDescuentoSpan.classList.add('hidden');
                precioOriginalSpan.classList.remove('line-through', 'text-gray-500', 'text-lg');
                precioOriginalSpan.classList.add('text-blue-700', 'text-xl');
                precioOriginalSpan.innerText = `S/ ${precio.toFixed(2)}`;
                descuentoBadge.classList.add('hidden');
            }

            const stock = parseInt(button.dataset.stock);
            const stockElement = document.getElementById('modal-stock');
            stockElement.innerText = `Stock: ${stock}`;
            stockElement.classList.remove('text-green-600', 'text-red-600');
            stockElement.classList.add(stock > 0 ? 'text-green-600' : 'text-red-600');
            if (stock === 0) {
                stockElement.innerText += ' (Agotado)';
            }

            const imagenUrl = button.dataset.imagenurl;
            document.getElementById('modal-imagen').src = imagenUrl && imagenUrl !== 'null' ? imagenUrl : 'https://placehold.co/400x300/E0E0E0/6A11CB?text=Producto';

            modal.classList.remove('hidden');
        }

        // Función para ocultar el modal
        function hideProductDetailsModal() {
            document.getElementById('productDetailsModal').classList.add('hidden');
        }

        // Cierra el modal si se hace clic fuera de él
        window.onclick = function(event) {
            const modal = document.getElementById('productDetailsModal');
            if (event.target == modal) {
                modal.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
